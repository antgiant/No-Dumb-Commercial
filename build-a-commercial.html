<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">    
        <title>NDQ - Custom Commercial Creator</title>
        <style>
            h1 {
                background-color:#2A7EBC;
                color:White;
                text-align:center;
                padding: 1em;
                margin: 0;
            }
            h2 {
                background-color: #8dacc2;
                color:White;
                margin: 0;
            }
            h3 {
                margin: 0;
            }
            h4 {
                padding-left: 1em;
            }
            p {
                padding-left: 2em;
                margin: 0;
            }
            audio {
                padding-left: 2em;
            }
            footer {
                background-color:#2A7EBC;
                color:White;
                text-align:center;
                padding: .5em;
            }
            .two-columns {
                column-count: 2;
                column-gap: 20px;
                column-rule: 4px dotted rgb(79, 185, 227);
            }
            .single_column {
                break-inside: avoid;
                page-break-inside: avoid;
            }
            .currently_playing {
                font-weight: bold;
            }
            li {
                user-select: none;
                position: relative;
                display:block;
                border: 1px solid black;
                background: white;
                margin: 0; padding: 0 1em;
                border-radius: 3px;
                margin-bottom: -1px;
                max-width: 100%;
                line-height: 3;
            }
            .slip-reordering {
                box-shadow: 0 2px 10px rgba(0,0,0,0.45);
            }
            .slip-swiping-container {
                overflow-x: hidden;
            }
            .float_right {
                float: right;
            }
            .visible_only_when_playlist_has_items {
                display: none;
            }
        </style>
    </head>
    <body>
        <script src="js/slip.js"></script>
        <script src="js/crunker.js"></script>
        <h1><a href="index.html" style="color: white;">No Dumb Commercial</a></h1>
        <h2 style="text-align: center;">Custom Commercial Creator</h2>
        <p>
            <br />
        </p>
        <section><p style="padding-left: 0em;">
            A <a href="https://www.nodumbquestions.fm/">No Dumb Questions</a> commercial creator using the Commercial material provided in <a href="https://www.nodumbquestions.fm/listen/2021/10/21/119-whats-on-the-radio">Episode 119</a>. 
            This site is intended to make it easy for you to create a radio commercial spot for the No Dumb Questions podcast as encouraged in <a href="https://www.nodumbquestions.fm/listen/2021/10/21/119-whats-on-the-radio">Episode 119</a>.<br />
            <br />
            <br />
        </p>
        </section>
        <section>
            <div class="two-columns">
                <div class="single_column">
                    <h2>Playlist</h2>
                    <ul id="playlist">
                    </ul>
                    <a href="javascript:reset_playlist()" class="visible_only_when_playlist_has_items" id="playlist_reset">Reset Playlist</a>
                    <p>
                        <br />
                    </p>
                    <audio controls autoplay id="player" class="visible_only_when_playlist_has_items"></audio>
                    <p>
                        <br />
                        <a href="javascript:download_commercial()" class="visible_only_when_playlist_has_items" id="playlist_download">Download Commercial</a>
                    </p>
                </div>
                <div class="single_column">
                    <h2>Source Material</h2>
                    <p>
                        <br />
                    </p>
                    <h3>Official Spots</h3>
                    <p>
                        <a href="javascript:add_to_playlist('official_spot')">Starting with Matt (The Original)</a><br />
                        <a href="javascript:add_to_playlist('secondary_spot')">Starting with Destin (The Redo)</a>
                    </p>
                    <h3>Bumpers</h3>
                    <p>
                        <a href="javascript:add_to_playlist('generic_bumper')">Generic</a><br />
                        <a href="javascript:add_to_playlist('cattle_bumper')">Cattle Market Update</a><br />
                        <a href="javascript:add_to_playlist('metal_bumper')">Angry Rage Metal Classic</a><br />
                        <a href="javascript:add_to_playlist('traffic_bumper')">Local Traffic on the 10s</a><br />
                        <a href="javascript:add_to_playlist('traffic2_bumper')">Traffic Update - Matt Version</a><br />
                        <a href="javascript:add_to_playlist('traffic3_bumper')">Traffic Update - Destin Version</a><br />
                        <a href="javascript:add_to_playlist('crotch_bumper')">Crotch Shot</a>
                    </p>
                    <h3>Station IDs</h3>
                    <p>
                        <a href="javascript:add_to_playlist('KHAS')">KHAS</a><br />
                        <a href="javascript:add_to_playlist('KHOL')">KHOL</a><br />
                        <a href="javascript:add_to_playlist('KIMN')">KIMN</a><br />
                        <a href="javascript:add_to_playlist('KISS')">KISS FM</a><br />
                        <a href="javascript:add_to_playlist('KOA')">KOA</a><br />
                        <a href="javascript:add_to_playlist('WGN')">WGN</a><br />
                        <a href="javascript:add_to_playlist('WKRP')">WKRP</a><br />
                        <a href="javascript:add_to_playlist('WQAH')">WQAH</a>
                    </p>
                    <h3>Snippets</h3>
                    <p>
                        <a href="javascript:add_to_playlist('described')">Podcast Described</a><br />
                        <a href="javascript:add_to_playlist('cattle')">Cattle</a><br />
                        <a href="javascript:add_to_playlist('brought')">Is brought to you by... (Destin)</a><br />
                        <a href="javascript:add_to_playlist('brought2')">Is brought to you by... (Matt)</a><br />
                        <a href="javascript:add_to_playlist('brought3')">Is brought to you by... Version 2 by Destin</a><br />
                        <a href="javascript:add_to_playlist('brought4')">Was brought to you by... (Matt)</a><br />
                        <a href="javascript:add_to_playlist('market')">Market</a><br />
                        <a href="javascript:add_to_playlist('this')">This</a><br />
                        <a href="javascript:add_to_playlist('traffic')">Traffic</a><br />
                        <a href="javascript:add_to_playlist('update')">Update</a><br />
                        <a href="javascript:add_to_playlist('sponsored')">Was sponsored by...</a><br />
                        <a href="javascript:add_to_playlist('onto')">Now on to the</a><br />
                        <a href="javascript:add_to_playlist('listening')">You're Listening To...</a>
                    </p>
                    <h3>Genres</h3>
                    <p>
                        <a href="javascript:add_to_playlist('meaningless')">Meaningless Adult Rock</a><br />
                        <a href="javascript:add_to_playlist('8090')">80s & 90s</a><br />
                        <a href="javascript:add_to_playlist('80s')">80s</a><br />
                        <a href="javascript:add_to_playlist('90s')">90s</a><br />
                        <a href="javascript:add_to_playlist('adult')">Adult</a><br />
                        <a href="javascript:add_to_playlist('classic')">Classic</a><br />
                        <a href="javascript:add_to_playlist('metal')">Metal</a><br />
                        <a href="javascript:add_to_playlist('rage')">Rage</a><br />
                        <a href="javascript:add_to_playlist('rock')">Rock</a>
                    </p>
                    <h3>Alphabet</h3>
                    <p>
                        <a href="javascript:add_to_playlist('A')">A</a><br />
                        <a href="javascript:add_to_playlist('B')">B</a><br />
                        <a href="javascript:add_to_playlist('C')">C</a><br />
                        <a href="javascript:add_to_playlist('D')">D</a><br />
                        <a href="javascript:add_to_playlist('K')">K</a><br />
                        <a href="javascript:add_to_playlist('W_matt')">W (by Matt)</a><br />
                        <a href="javascript:add_to_playlist('W_destin')">W (by Destin)</a>
                    </p>
                </div>
            </div>
        </section>
        <section><br /><br /><br /></section>
        <footer>
            <p style="padding-left: 0em;">
                This site is cookie and tracking free. Source available <a href="https://github.com/antgiant/No-Dumb-Commercial">here</a>, but more importantly go subscribe to <a href="https://www.nodumbquestions.fm/">No Dumb Questions</a>.<br />
                <br />
                <a href="index.html">Home</a>
            </p>
        </footer>
        <script> 
            var playlist = document.getElementById('playlist');
            var player = document.getElementById('player');
            player.addEventListener('ended', get_next_track, false);

            function add_to_playlist(item) {
                var item_details = get_details(item);
                var playlist_item = document.createElement('li');
                playlist_item.innerHTML = "<span class='"+item+"'>"+item_details.name+"</span><span class='float_right instant'>≡</span>";
                playlist.appendChild(playlist_item);
                set_playlist();
            }

            function get_details(item) {
                var detail = {name:"", url:""};
                switch (item) {
                    case 'official_spot': 
                        detail.name = "Starting with Matt (The Original)";
                        detail.url = "audio/Official Spot.mp3";
                        break;
                    case 'secondary_spot': 
                        detail.name = "Starting with Destin (The Redo)";
                        detail.url = "audio/Official Spot (Second Version).mp3";
                        break;
                    case 'generic_bumper': 
                        detail.name = "Generic";
                        detail.url = "audio/Bumpers/Generic.mp3";
                        break;
                    case 'cattle_bumper': 
                        detail.name = "Cattle Market Update";
                        detail.url = "audio/Bumpers/Cattle Market Update.mp3";
                        break;
                    case 'metal_bumper': 
                        detail.name = "Angry Rage Metal Classic";
                        detail.url = "audio/Bumpers/Angry Rage Metal Classic.mp3";
                        break;
                    case 'traffic_bumper': 
                        detail.name = "Local Traffic on the 10s";
                        detail.url = "audio/Bumpers/Local Traffic on the 10s.mp3";
                        break;
                    case 'traffic2_bumper': 
                        detail.name = "Traffic Update - Matt Version";
                        detail.url = "audio/Bumpers/Traffic Update.mp3";
                        break;
                    case 'traffic3_bumper': 
                        detail.name = "Traffic Update - Destin Version";
                        detail.url = "audio/Bumpers/Traffic Update - Destin Version.mp3";
                        break;
                    case 'crotch_bumper': 
                        detail.name = "Crotch Shot";
                        detail.url = "audio/Bumpers/Crotch Shot.mp3";
                        break;
                    case 'described': 
                        detail.name = "Podcast Described";
                        detail.url = "audio/Fun/Podcast Described.mp3";
                        break;
                    case 'KHAS':
                        detail.name = "KHAS";
                        detail.url = "audio/Station_IDs/KHAS.mp3";
                        break;
                    case 'KHOL': 
                        detail.name = "KHOL";
                        detail.url = "audio/Station_IDs/KHOL.mp3";
                        break;
                    case 'KIMN': 
                        detail.name = "KIMN";
                        detail.url = "audio/Station_IDs/KIMN.mp3";
                        break;
                    case 'KISS': 
                        detail.name = "KISS FM";
                        detail.url = "audio/Station_IDs/KISS FM.mp3";
                        break;
                    case 'KOA': 
                        detail.name = "KOA";
                        detail.url = "audio/Station_IDs/KOA.mp3";
                        break;
                    case 'WGN': 
                        detail.name = "WGN";
                        detail.url = "audio/Station_IDs/WGN.mp3";
                        break;
                    case 'WKRP': 
                        detail.name = "WKRP";
                        detail.url = "audio/Station_IDs/WKRP.mp3";
                        break;
                    case 'WQAH': 
                        detail.name = "WQAH";
                        detail.url = "audio/Station_IDs/WQAH.mp3";
                        break;
                    case 'meaningless': 
                        detail.name = "Meaningless Adult Rock";
                        detail.url = "audio/Fun/Meaningless Adult Rock.mp3";
                        break;
                    case 'A': 
                        detail.name = "A";
                        detail.url = "audio/Alphabet/A.mp3";
                        break;
                    case 'B': 
                        detail.name = "B";
                        detail.url = "audio/Alphabet/B.mp3";
                        break;
                    case 'C': 
                        detail.name = "C";
                        detail.url = "audio/Alphabet/C.mp3";
                        break;
                    case 'D': 
                        detail.name = "D";
                        detail.url = "audio/Alphabet/D.mp3";
                        break;
                    case 'K': 
                        detail.name = "K";
                        detail.url = "audio/Alphabet/K (Matt).mp3";
                        break;
                    case 'W_matt': 
                        detail.name = "W (by Matt)";
                        detail.url = "audio/Alphabet/W (Matt).mp3";
                        break;
                    case 'W_destin': 
                        detail.name = "W (by Destin)";
                        detail.url = "audio/Alphabet/W.mp3";
                        break;
                    case '8090': 
                        detail.name = "80s & 90s";
                        detail.url = "audio/Generes/80s & 90s.mp3";
                        break;
                    case '80s': 
                        detail.name = "80s";
                        detail.url = "audio/Generes/80s.mp3";
                        break;
                    case '90s': 
                        detail.name = "90s";
                        detail.url = "audio/Generes/90s.mp3";
                        break;
                    case 'adult': 
                        detail.name = "Adult";
                        detail.url = "audio/Generes/Adult.mp3";
                        break;
                    case 'classic': 
                        detail.name = "Classic";
                        detail.url = "audio/Generes/Classic.mp3";
                        break;
                    case 'metal': 
                        detail.name = "Metal";
                        detail.url = "audio/Generes/Metal.mp3";
                        break;
                    case 'rage': 
                        detail.name = "Rage";
                        detail.url = "audio/Generes/Rage.mp3";
                        break;
                    case 'rock': 
                        detail.name = "Rock";
                        detail.url = "audio/Generes/Rock.mp3";
                        break;
                    case 'cattle': 
                        detail.name = "Cattle";
                        detail.url = "audio/Snippets/Cattle.mp3";
                        break;
                    case 'listening': 
                        detail.name = "You're Listening To...";
                        detail.url = "audio/Snippets/You're Listening To....mp3";
                        break;
                    case 'brought': 
                        detail.name = "Is brought to you by... (Destin)";
                        detail.url = "audio/Snippets/Is brought to you by... (Destin).mp3";
                        break;
                    case 'brought2': 
                        detail.name = "Is brought to you by... (Matt)";
                        detail.url = "audio/Snippets/Is brought to you by... (Matt).mp3";
                        break;
                    case 'brought3': 
                        detail.name = "Is brought to you by... Version 2 by Destin";
                        detail.url = "audio/Snippets/Is brought to you by... Version 2 by Destin.mp3";
                        break;
                    case 'market': 
                        detail.name = "Market";
                        detail.url = "audio/Snippets/Market.mp3";
                        break;
                    case 'onto': 
                        detail.name = "Now on to the";
                        detail.url = "audio/Snippets/Now on to the.mp3";
                        break;
                    case 'this': 
                        detail.name = "This";
                        detail.url = "audio/Snippets/This.mp3";
                        break;
                    case 'traffic': 
                        detail.name = "Traffic";
                        detail.url = "audio/Snippets/Traffic.mp3";
                        break;
                    case 'update': 
                        detail.name = "Update";
                        detail.url = "audio/Snippets/Update.mp3";
                        break;
                    case 'brought4': 
                        detail.name = "Was brought to you by... (Matt)";
                        detail.url = "audio/Snippets/Was brought to you by... (Matt).mp3";
                        break;
                    case 'sponsored': 
                        detail.name = "Was sponsored by...";
                        detail.url = "audio/Snippets/Was sponsored by....mp3";
                        break;
                }
                return detail;
            }

            function set_playlist() {
                player.pause();

                for(i= 0; i < document.styleSheets[0].cssRules.length; i++) {
                    if (document.styleSheets[0].cssRules[i].selectorText === ".visible_only_when_playlist_has_items") {
                        document.styleSheets[0].cssRules[i].style['display'] = 'inline';
                    }
                }

                var playing = document.getElementsByClassName("currently_playing");
                for(i = 0; i < playing.length; i++) {
                    playing[i].classList.remove('currently_playing');
                }
                
                if (playlist.children[0] !== undefined) {
                    player.src = get_details(playlist.children[0].firstElementChild.classList[0]).url;
                    playlist.children[0].classList.add("currently_playing");
                    player.pause();
                } else {
                    reset_playlist();
                }

                //Set Share Link
                var url="?";
                for (i = 0; i < playlist.children.length; i++) {
                    if (i === 0) {
                        url = "?tracks="+playlist.children[i].firstElementChild.classList[0];
                    } else {
                        url += ","+playlist.children[i].firstElementChild.classList[0];
                    }
                }
                if (window.history.replaceState) {
                    //prevents browser from storing history with each change:
                    window.history.replaceState(null, "", url);
                }
                
            }

            function get_next_track() {
                var next = false;
                for (i = 0; i < playlist.children.length; i++) {
                    if (playlist.children[i].classList.contains("currently_playing")) {
                        playlist.children[i].classList.remove('currently_playing');
                        next = true;
                    } else if (next) {
                        playlist.children[i].classList.add("currently_playing");
                        player.src = get_details(playlist.children[i].firstElementChild.classList[0]).url;
                        return;
                    }
                }
                //Getting here means we have reached the end of the playlist
                if (playlist.children[0] !== undefined) {
                    player.src = get_details(playlist.children[0].firstElementChild.classList[0]).url;
                    playlist.children[0].classList.add("currently_playing");
                    player.pause();
                }
            }

            function reset_playlist() {
                for(i= 0; i < document.styleSheets[0].cssRules.length; i++) {
                    if (document.styleSheets[0].cssRules[i].selectorText === ".visible_only_when_playlist_has_items") {
                        document.styleSheets[0].cssRules[i].style['display'] = 'none';
                    }
                }

                for (i = playlist.children.length - 1; i >= 0; i--) {
                    playlist.children[i].remove();
                }
                player.src = "";

                if (window.history.replaceState) {
                    //prevents browser from storing history with each change:
                    window.history.replaceState(null, "", "?");
                }
            }

            function download_commercial() {
                let paths = [];
                for (i = 0; i < playlist.children.length; i++) {
                    paths.push(get_details(playlist.children[i].firstElementChild.classList[0]).url);
                }
                doTheCrunkerWork("concatAudio", "No Dumb Questions Commercial", paths);
            }

            async function doTheCrunkerWork(task, filename, audioPaths) {
                const crunker	= new Crunker.default({ sampleRate: 48000 })
                const buffers	= await crunker.fetchAudio(...audioPaths);
                const merged	= await crunker[task](buffers);
                const output	= await crunker.export(merged, "audio/mp3");
                await crunker.download(output.blob, filename);
            }
            (new Crunker.default()).notSupported(() => {
                document.getElementById("playlist_download").parentElement.innerHTML = "<br /><span id='playlist_download'>Your Browser doesn't support downloading. Sorry.</span>";
            });


            playlist.addEventListener('slip:afterswipe', function(e){
                // list will collapse over that element
                e.target.parentNode.removeChild(e.target);
                set_playlist();
            }, false);

            playlist.addEventListener('slip:reorder', function(e){
                e.target.parentNode.insertBefore(e.target, e.detail.insertBefore);
                set_playlist();
                return false;
            }, false);

            playlist.addEventListener('slip:beforewait', function(e){
                if (e.target.className.indexOf('instant') > -1) e.preventDefault();
            }, false);

            new Slip(playlist);

            //Setup playlist if coming in via Share Link
            const urlParams = new URLSearchParams(window.location.search);
            const tracks = urlParams.get('tracks');
            if (tracks !== null) {
                const track_array = tracks.split(',');
                for (j = 0; j < track_array.length; j++) {
                    add_to_playlist(track_array[j]);
                }
            }

        </script> 
    </body>
</html>
